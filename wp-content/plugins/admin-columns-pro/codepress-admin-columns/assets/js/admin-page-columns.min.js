var AC;var incremental_column_name=0;jQuery(document).ready(function(b){if(b("#cpac").length===0){return false}cpac_init(b);cpac_submit_form(b);cpac_reset_columns(b);cpac_menu(b);cpac_add_column(b);cpac_sidebar_feedback(b)});function ac_show_ajax_message(d,e){var f=jQuery('<div class="ac-message hidden '+e+'"><p>'+d+"</p></div>");jQuery(".ac-boxes").before(f);f.slideDown()}function cpac_submit_form(c){var d=c(".sidebox a.submit, .column-footer a.submit");d.click(function(){var g=c(this);var a=g.closest(".ac-admin").addClass("saving");var h=a.find(".ac-columns form").serialize();d.attr("disabled","disabled");a.find(".ac-message").remove();var b=c.post(ajaxurl,{action:"ac_columns_save",data:h,_ajax_nonce:AC._ajax_nonce,list_screen:AC.list_screen,layout:AC.layout,original_columns:AC.original_columns},function(e){if(e){if(e.success){ac_show_ajax_message(e.data,"updated");a.addClass("stored")}else{if(e.data){ac_show_ajax_message(e.data.message,"notice notice-warning")}}}else{}},"json");b.fail(function(e){});b.always(function(){d.removeAttr("disabled","disabled");a.removeClass("saving")});c(document).trigger("cac_update",a)})}function cpac_add_column(b){b(".add_column").click(function(a){a.preventDefault();var d=b("#add-new-column-template").find(".ac-column").clone();d.cpac_update_clone_id();d.addClass("opened").find(".ac-column-body").slideDown(150,function(){b("html, body").animate({scrollTop:d.offset().top-58},300)});b(".ac-columns form").append(d);d.column_bind_toggle();d.column_bind_remove();d.column_bind_clone();d.column_bind_events();b(document).trigger("column_add",d)})}function cpac_sidebar_feedback(c){var d=c(".sidebox#direct-feedback");d.find("#feedback-choice a.no").click(function(a){a.preventDefault();d.find("#feedback-choice").slideUp();d.find("#feedback-support").slideDown()});d.find("#feedback-choice a.yes").click(function(a){a.preventDefault();d.find("#feedback-choice").slideUp();d.find("#feedback-rate").slideDown()})}function cpac_init(g){var f=g(".ac-admin");var h=f.find(".ac-boxes");if(h.hasClass("disabled")){h.find(".ac-column").each(function(a,b){g(b).column_bind_toggle();g(b).find("input, select").prop("disabled",true)})}else{var e=h.find(".ac-columns");e.find(".ac-column").each(function(a,b){g(b).column_bind_toggle();g(b).column_bind_remove();g(b).column_bind_clone();g(b).cpac_bind_indicator_events()});e.cpac_bind_ordering()}g(document).trigger("cac_menu_change",e);g(document).trigger("cac_model_ready",f.data("type"))}function cpac_menu(b){b("#ac_list_screen").on("change",function(){b(".view-link").hide();b(this).parents("form").submit();b(this).prop("disabled",true).next(".spinner").css("display","inline-block")})}function cpac_reset_columns(d){var c=d(".ac-admin");d("a[data-clear-columns]").on("click",function(){c.find(".ac-column").each(function(){d(this).find(".remove-button").trigger("click")})})}(function(b){b.fn.column_bind_toggle=function(){var d=b(this);var a=d.closest(".ac-boxes").hasClass("disabled");d.find('[data-toggle="column"]').click(function(c){c.preventDefault();d.toggleClass("opened").find(".ac-column-body").slideToggle(150);if(a){return}if(!d.hasClass("events-binded")){d.column_bind_events()}d.addClass("events-binded");b(document).trigger("column_init",d)}).css("cursor","pointer")};b.fn.column_bind_remove=function(){b(this).find(".remove-button").click(function(a){b(this).closest(".ac-column").column_remove();a.preventDefault()})};b.fn.column_bind_clone=function(){b(this).find(".clone-button").click(function(d){d.preventDefault();var a=b(this).closest(".ac-column").column_clone();if(typeof a!=="undefined"){a.removeClass("loading").hide().slideDown()}})};b.fn.cpac_column_refresh=function(){var n=b(this);var a=n.find('[data-refresh="column"]');var k=b(this).attr("data-column-name");var i=n.hasClass("opened");b(document).trigger("pre_column_refresh",n);var l=b(this).find(":input").serializeArray();var m={action:"ac_column_refresh",_ajax_nonce:AC._ajax_nonce,list_screen:AC.list_screen,layout:AC.layout,column_name:k,original_columns:AC.original_columns};b.each(m,function(d,c){l.push({name:d,value:c})});n.addClass("loading");a.prop("disabled",1);var j=b.post(ajaxurl,l,function(d){if(d){var c=b("<div>"+d.data+"</div>").children();n.replaceWith(c);n=c;n.column_bind_toggle();n.column_bind_remove();n.column_bind_clone();n.column_bind_events();if(i){n.addClass("opened").find(".ac-column-body").show()}b(document).trigger("column_change",n)}else{}},"json");j.fail(function(c){var d=n.closest(".ac-admin").find(".ajax-message");d.addClass("error").find("p").html(AC.i18n.error);d.slideDown();n.slideUp(function(){n.remove()});console.log("responseText: "+c.responseText)});j.always(function(){n.removeClass("loading");a.prop("disabled",false)})};b.fn.column_bind_events=function(){var e=b(this);var f=e.closest(".ac-admin ");var a=e.find("select.ac-setting-input_type option:selected").val();e.find("select.ac-setting-input_type").change(function(){var j=b("optgroup",this).children(":selected");var k=j.val();var c=b(this).next(".msg").hide();var l=b(this);var d=[];f.find(".ac-column[data-original=1]").each(function(){d.push(b(this).data("type"))});e.addClass("loading");b.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"ac_column_select",type:k,current_original_columns:d,original_columns:AC.original_columns,list_screen:AC.list_screen,layout:AC.layout,_ajax_nonce:AC._ajax_nonce}}).done(function(i){if(i){if(i.success){var h=e.closest(".ac-column");var g=b("<div>"+i.data+"</div>").children();h.replaceWith(g);h=g;h.column_bind_toggle();h.column_bind_remove();h.column_bind_clone();h.column_bind_events();h.addClass("opened").find(".ac-column-body").show();h.cpac_update_clone_id();b(document).trigger("column_change",h)}else{if(i.data){if("message"===i.data.type){c.html(i.data.error).show();l.find("option").removeAttr("selected");l.find('option[value="'+a+'"]').attr("selected","selected")}}}}}).always(function(){e.removeClass("loading")})});e.find(".ac-column-setting--label input").bind("keyup change",function(){var c=b(this).val();b(this).closest(".ac-column").find("td.column_label .inner > a.toggle").html(c)});e.find(".ac-column-body .col-label .label").hover(function(){b(this).parents(".col-label").find("div.tooltip").show()},function(){b(this).parents(".col-label").find("div.tooltip").hide()});e.find('select[data-label="update"]').change(function(){var d=e.find("input.ac-setting-input_label");var c=b(this).find("option:selected").text();d.val(c);d.trigger("change")});e.find('[data-refresh="column"]').change(function(){e.cpac_column_refresh()});b(document).trigger("init_settings",e)};b.fn.column_bind_settings=function(){var a=b(this);a.find(".ac-column-setting--image_size").cpac_column_setting_image_size();a.find(".ac-column-setting--width").cpac_column_setting_width()};b.fn.column_remove=function(){b(this).addClass("deleting").animate({opacity:0,height:0},350,function(){b(this).remove()})};b.fn.column_clone=function(){var h=b(this);var a=b(this).closest("ac-columns");if("1"===h.attr("data-original")){var g=AC.i18n.clone.replace("%s","<strong>"+h.find(".column_label .toggle").text()+"</strong>");h.addClass("opened").find(".ac-column-body").slideDown(150);h.find(".ac-setting-input_type").next(".msg").html(g).show();return}var f=b(this).clone();f.cpac_update_clone_id();b(this).after(f);f.column_bind_toggle();f.column_bind_remove();f.column_bind_clone();f.column_bind_events();a.cpac_bind_ordering();b(document).trigger("column_add",f);return f};b.fn.cpac_update_clone_id=function(){var g=b(this);var h=g.attr("data-column-name");var f="_new_column_"+incremental_column_name;var a=g.find("input, select, label");b(a).each(function(c,d){if(b(d).attr("name")){b(d).attr("name",b(d).attr("name").replace("columns["+h+"]","columns["+f+"]"))}if(b(d).attr("id")){b(d).attr("id",b(d).attr("id").replace("-"+h+"-","-"+f+"-"))}});g.attr("data-column-name",f);incremental_column_name++};b(document).bind("column_init column_change column_add",function(e,a){var f=b(a).closest(".ac-boxes").hasClass("disabled");if(f){return}b(a).cpac_bind_column_addon_events();b(a).cpac_bind_indicator_events()});b.fn.cpac_bind_column_addon_events=function(){var d=b(this);var a=d.find("[data-trigger] label");a.on("click",function(){var c=b(this).closest("td.input").data("trigger");var h=b("input",this).val();var i=d.find('[data-indicator-id="'+c+'"]').removeClass("on");if("on"==h){i.addClass("on")}var j=d.find('[data-handle="'+c+'"]').addClass("hide");if("on"==h){j.removeClass("hide")}});d.find("[data-trigger]").each(function(){var c=b(this).data("trigger");var f=d.find('[data-handle="'+c+'"]').addClass("hide");if("on"==b("input:checked",this).val()){f.removeClass("hide")}})};b.fn.cpac_bind_indicator_events=function(){var d=b(this);var a=d.find(".ac-column-header [data-indicator-toggle]");a.each(function(){var h=b(this);var i=b(this).data("setting");var j=d.find(".ac-column-setting[data-setting="+i+"]");var c=j.find(".col-input:first .ac-setting-input:first input[type=radio]");h.unbind("click").on("click",function(e){e.preventDefault();h.toggleClass("on");if(b(this).hasClass("on")){c.filter("[value=on]").prop("checked",true).trigger("click").trigger("change")}else{c.filter("[value=off]").prop("checked",true).trigger("click").trigger("change")}});c.on("change",function(){var e=c.filter(":checked").val();if("on"==e){h.addClass("on")}else{h.removeClass("on")}})})};b.fn.cpac_bind_ordering=function(){b(this).each(function(){if(b(this).hasClass("ui-sortable")){b(this).sortable("refresh")}else{b(this).sortable({items:".ac-column",handle:".column_sort"})}})};b.fn.cpac_column_setting_image_size=function(){function a(e,f){if("cpac-custom"==f.val()){e.find(".ac-column-setting").show()}else{e.find(".ac-column-setting").hide()}}b(this).each(function(){var e=b(this);var f=b(this).find(".ac-setting-input select");a(e,f);f.on("change",function(){a(e,b(this))})})};b(document).on("init_settings",function(d,a){b(a).find(".ac-column-setting--image").cpac_column_setting_image_size()});b.fn.column_width_slider=function(){var i=b(this).find(".ac-setting-input-width");var j=i.find(".description input"),n=i.find(".unit-select input"),k=n.filter(":checked").val(),m=j.val(),l=i.find(".width-slider"),a=b(this).find(".ac-column-header .ac-column-heading-setting--width");if("%"==k&&m>100){m=100}j.val(m);l.slider({range:"min",min:0,max:"%"==k?100:500,value:m,slide:function(d,c){j.val(c.value);a.trigger("update");j.trigger("validate")}})};b.fn.cpac_column_setting_width=function(){b(this).each(function(){var f=b(this).parents(".ac-column");f.column_width_slider();var a=f.find(".ac-column-header .ac-column-heading-setting--width");a.on("update",function(){var d=f.find(".ac-setting-input-width .description input").val();var c=f.find(".ac-setting-input-width .description .unit").text();if(d>0){b(this).text(d+c)}else{b(this).text("")}});var g=f.find(".ac-setting-input-width .unit-select label");g.on("click",function(){f.find("span.unit").text(b(this).find("input").val());f.column_width_slider();a.trigger("update")});var h=f.find(".ac-setting-input-width .description input").on("keyup",function(){f.column_width_slider();b(this).trigger("validate");a.trigger("update")}).on("validate",function(){var d=h.val();var c=b.trim(d);if(!b.isNumeric(c)){c=c.replace(/\D/g,"")}if(c.length>3){c=c.substring(0,3)}if(c<=0){c=""}if(c!==d){h.val(c)}})})};b.fn.cpac_column_sub_setting_toggle=function(a){var e=b.extend({value_show:"on",subfield:".ac-column-setting"},a);function f(j,c){var d=c.filter(":checked").val();var i=j.find(e.subfield);if(e.value_show==d){i.show()}else{i.hide()}}b(this).each(function(){var d=b(this);var c=b(this).find('.ac-setting-input input[type="radio"]');f(d,c);c.on("change",function(){f(d,c)})})};b.fn.cpac_column_setting_date=function(){b(this).each(function(){var h=b(this);var a=h.find("input.custom");var j=h.find(".ac-setting-input-date__custom");var i=h.find(".ac-setting-input-date__example");var l=h.find("input[type=radio]:checked");var k=h.find(".help-msg");h.find("input[type=radio]").on("change",function(){var c=b(this);var e=c.closest("label");var d=e.find("code").text();var f=e.find(".ac-setting-input-date__more").html();if(d){j.val(d).trigger("change")}if(c.hasClass("diff")){j.val("");i.text("")}j.prop("disabled",true);if(c.hasClass("custom")){c.val(j.val());j.prop("disabled",false);k.show()}k.hide();if(f){k.html(f).show()}});j.on("change",function(){i.html('<span class="spinner is-active"></span>');a.val(j.val());var c=b(this).val();if(!c){i.text("");return}b.ajax({url:ajaxurl,method:"post",data:{action:"date_format",date:c}}).done(function(d){i.text(d)})});l.trigger("change");if(0===l.length){a.trigger("click")}})};b(document).on("init_settings",function(d,a){b(a).find(".ac-column-setting--width").cpac_column_setting_width();b(a).find(".ac-column-setting--date").cpac_column_setting_date();b(a).find(".ac-column-setting--filter").cpac_column_sub_setting_toggle();b(a).find(".ac-column-setting--sort").cpac_column_sub_setting_toggle();b(a).find(".ac-column-setting--edit").cpac_column_sub_setting_toggle()})}(jQuery));